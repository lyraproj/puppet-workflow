 attach:
   typespace: lyra::aws
   input:
     region:
       type: String
       lookup: aws.region
     tags:
       type: Hash[String,String]
       lookup: aws.tags
     key_name:
       type: String
       lookup: aws.keyname
     ec2_cnt:
       type: Integer
       lookup: aws.instance.count
   output:
     vpc_id: String
     subnet_id: String
     internet_gateway_id: String
     nodes: Hash[String,Struct[public_ip=>String,private_ip=>String]]
   activities:
     vpc:
       output: vpc_id
       state:
         ensure              : present
         region              : $region
         cidr_block          : 192.168.0.0/16
         tags                : $tags
         enable_dns_hostnames: true
         enable_dns_support  : true
     subnet:
       output: subnet_id
       state:
         ensure                 : present
         region                 : $region
         vpc_id                 : $vpc_id
         cidr_block             : 192.168.1.0/24
         tags                   : $tags
         map_public_ip_on_launch: true
     instance:
       output:
         key: instance_id
         value: [public_ip, private_ip]
       iteration:
         name:     nodes
         function: times
         over:     ec2_cnt
         vars:     i
       state:
         region       : $region
         ensure       : present
         instance_id  : $i
         image_id     : ami-f90a4880
         instance_type: t2.nano
         key_name     : $key_name
         tags         : $tags
     gw:
       type: Lyra::Aws::InternetGateway
       output: internet_gateway_id
       state:
         ensure: present
         region: $region
         tags  : $tags
